<!DOCTYPE html> 
<html>
<head>
    <title>Graph Gen</title>
    
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" /> 
        
    <script src="../vendor/raphael.min.js" type="text/javascript"></script>
    <script src="../src/point.js" type="text/javascript"></script>
    <script src="../src/line.js" type="text/javascript"></script>
    <script src="../src/hexagon.js" type="text/javascript"></script>
    <script src="../src/country.js" type="text/javascript"></script>
    <script src="../src/map.js" type="text/javascript"></script>
    <script src="../src/mapgenerator.js" type="text/javascript"></script>
    
    <link href='style.css' rel='stylesheet' type='text/css'>
</head>
<body>
    <div id="panel">
        <div id="settings">
            <form>
                <fieldset id="firstColumn">
                    <span>Size of map (px): </span><input type="text" id="mapWidth" value="1200"/> x <input type="text" id="mapHeight" value="450"/><br />
                    <span>Size of a hexagon (px): </span><input type="text" id="hexagonSize" value="40"/><br />
                    <span>Number of countries: </span><input type="text" id="numberOfCountries" value="5"/>
                </fieldset>
                <fieldset id="secondColumn">
                    <span>Country size variance (0 - 0.9): </span><input type="text" id="countrySizeVariance" value="0.5"/><br />
                    <span>Distortion: </span><input type="checkbox" id="useDistortion">
                </fieldset>
                <fieldset id="thirdColumn">
                    <span>Compact country shapes:</span><input type="checkbox" id="useCompactShapes"><br />
                    <span>Show centers and connections:</span><input type="checkbox" id="showCentersAndConnection" checked><br />
                    <input type="button" id="generate" value="Generate New Map">
                </fieldset>
            </form>
        </div>
    </div>
    <div id="paper">
    </div>
    
    <script type="text/javascript">

        var map;

        function generate() {
            var width = parseInt(document.getElementById('mapWidth').value);
            var height = parseInt(document.getElementById('mapHeight').value);
            var hexagonSize = parseInt(document.getElementById('hexagonSize').value);
            var numberOfCountries = parseInt(document.getElementById('numberOfCountries').value);
            var countrySizeVariance = parseFloat(document.getElementById('countrySizeVariance').value);
            var useDistortion = document.getElementById('useDistortion').checked;
            var showCentersAndConnection = document.getElementById('showCentersAndConnection').checked;
            var useCompactShapes = document.getElementById('useCompactShapes').checked;
            
            paper.clear();
            paper.setSize(width, height);
            Raphael.getColor.reset();
            
            try {
                var generator = new MapGenerator();
                
                generator.createHexagonPattern(
                    width,
                    height,
                    hexagonSize,
                    useDistortion
                );
                
                generator.generate(
                    numberOfCountries,
                    countrySizeVariance,
                    useCompactShapes
                );
                
                map = generator.getMap();
                
                for (var i = 0; i < map.regions.length; i++) {          
                    paper.path(map.regions[i].pathString).attr("fill", '#888888'); //Raphael.getColor(0.4));
                    
                    var x = map.regions[i].center.x,
                        y = map.regions[i].center.y;

                    if (showCentersAndConnection) {
                        paper.circle(x, y, 5).attr("fill", '#eeea10');
                        paper.text(x, y, i + 1);
                    }
                }
                
                if (showCentersAndConnection) {
                    for (var i = 0; i < map.adjacencyMatrix.length; i++) {
                        for (var j = 0; j < i; j++) {
                            if (map.adjacencyMatrix[i][j] != 0) {
                                var x1 = map.regions[i].center.x,
                                    y1 = map.regions[i].center.y,
                                    x2 = map.regions[j].center.x,
                                    y2 = map.regions[j].center.y;
                                paper.path(
                                    'M ' + x1 + 
                                    ',' + y1 + 
                                    ' L ' + x2 + 
                                    ',' + y2 + ' Z'
                                ).attr({'stroke': '#ffffff', 'stroke-width': 2, 'opacity': 0.3});

                                paper.text((x1+x2)/2, (y1+y2)/2, map.adjacencyMatrix[i][j].toFixed(2));

                            }

                        }
                    } 
                }
            } catch(e) {
                alert(e);
            }
        }
        
        var button = document.getElementById('generate');
        var paper = Raphael("paper", 10, 10);
    
        button.onclick = generate;
        generate();
    </script>
</body>
</html>